<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>HelloJNI : Burt.K</title>

    <link href='https://fonts.googleapis.com/css?family=Lato:300italic,700italic,300,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header >
        <h1><a href="/archive">Burt.K</a></h1>
        
          <p>코코아를 좋아하는 프로그래머입니다 ;)</p>
        

        <ul>
          <li><a href="/about"><strong>소개</strong></a></li>
          <li><a href="/archive"><strong>아카이브</strong></a></li>
          <li><a href="/opensources"><strong>오픈소스</strong></a></li>
          <li><a href="/books"><strong>책모음</strong></a></li>
        </ul>    

      </header>
      <section>


		<h1 class="entry-title">
		
		    <a href="/hellojni/">HelloJNI</a>
		
		
		</h1>
		
      <p class="p1">
  <span class="s1">맥에서 Hello JNI!를 출력하는 자바 응용프로그램을 개발해 보자. 단 이 응용프로그램은 문자열을 출력하는 부분을 C++ 로 작성할 것이다.</span>
</p>

<p class="p1">
  <span class="s1">네이티브 라이브러를 사용하는 자바 클래스 작성하기</span>
</p>

<li class="p1">
  더 편하게 읽기 : <a href="http://skyfe79.gitbooks.io/jni-tutorial/content/chapter1.html">http://skyfe79.gitbooks.io/jni-tutorial/content/chapter1.html</a>
</li>

<p class="p1">
  <!--more-->
</p>

<pre class="lang:default decode:true">$ vi HelloJNI.java</pre>

<pre class="lang:default decode:true ">// 주의! 학습 편의를 위해서 패키지를 작성하지 않는다!

class HelloJNI {
    private native void print();
    public static void main(String[] args) {
        new HelloJNI().print();
    }
    static {
        System.loadLibrary("HelloJNI");
    }
}</pre>

<p class="p1">
  <span class="s1">자바 코드 파일을 컴파일하여 class파일을 만든다.</span>
</p>

<pre class="lang:default decode:true ">$ javac HelloJNI.java</pre>

<p class="p1">
  <span class="s1">JNI C++ 파일을 만들기 위해서 javah를 이용해 C++ 헤더파일을 만든다.</span>
</p>

<pre class="lang:default decode:true">$ javah -jni HelloJNI</pre>

<p class="p1">
  <span class="s1">만들어진 파일을 확인해 보자</span>
</p>

<pre class="lang:default decode:true ">$ cat HelloJNI.h</pre>

<pre class="lang:default decode:true ">/* DO NOT EDIT THIS FILE - it is machine generated */
#include &lt;jni.h&gt;
/* Header for class HelloWorld */
 
#ifndef _Included_HelloJNI
#define _Included_HelloJNI
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     HelloJNI
 * Method:    print
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_HelloJNI_print
  (JNIEnv *, jobject);
 
#ifdef __cplusplus
}
#endif
#endif</pre>

<p>JNI 함수명과 인자타입 등은 관련 문서를 참고한다.</p>

<p class="p1">
  <span class="s1">Java_HelloJNI_print 함수를 작성한다.</span>
</p>

<pre class="lang:default decode:true">$ vi HelloJNI.cpp</pre>

<pre class="lang:default decode:true ">#include &lt;jni.h&gt;
#include &lt;iostream&gt;
#include "HelloJNI.h"
 
JNIEXPORT void JNICALL Java_HelloJNI_print
(
    JNIEnv  *env, 
    jobject  thiz
)
{
    std::cout &lt;&lt; "Hello JNI!" &lt;&lt; std::endl;
}</pre>

<p class="p1">
  <span class="s1">HelloJNI 네이티브 라이브러리를 만들기 위해서는 jni.h 파일의 위치를 알아야 한다. 맥에서는 아래의 위치에 있다.</span>
</p>

<pre class="lang:default decode:true ">$ ls /System/Library/Frameworks/JavaVM.framework/Versions/Current/Headers/</pre>

<p class="p1">
  <span class="s1">컴파일해 보자</span>
</p>

<pre class="lang:default decode:true ">$ g++ "-I/System/Library/Frameworks/JavaVM.framework/Versions/Current/Headers/" -c HelloJNI.cpp</pre>

<p class="p1">
  <span class="s1">컴파일하면 HelloJNI.o 파일이 생성된다. 이제 동적라이브러리를 생성한다. 주의할 점은 라이브러리명은 반드시 lib으로 시작해야 하고 확장자는 jnilib 이여야 한다. 위 컴파일문에서 jni.h를 찾을 수 없다는 오류가 발생하면 jni.h 가 있는 곳을 찾아서 적어줘야 한다. 아래처럼 심볼링 링크를 직접 만들어서 사용해야 한다. 예를 들어 /System/Library/Java/JavaVirtualMachines/Headers 폴더를 만든 후 해당 폴더로 이동한 다음 아래의 명령어를 실행한다.</span>
</p>

<pre class="lang:default decode:true ">$ sudo ln -s /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.10.sdk/System/Library/Frameworks/JavaVM.framework/Versions/A/Headers/jni.h jni.h
$ ln -s /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.10.sdk/System/Library/Frameworks/JavaVM.framework/Versions/A/Headers/jni_md.h jni_md.h</pre>

<pre class="lang:default decode:true ">$ g++ -dynamiclib -o libhellojni.jnilib HelloJNI.o</pre>

<p class="p1">
  <span class="s1">실행한다</span>
</p>

<pre class="lang:default decode:true ">$ java HelloJNI
Hello JNI!</pre>

<p>만약 아래와 같은 링크 오류가 발생하면 실행할 때 네이티브 라이브러리가 있는 위치를 설정해야 한다.</p>

<pre class="lang:default decode:true ">Exception in thread "main" java.lang.UnsatisfiedLinkError: no HelloJNI in java.library.path</pre>

<pre class="lang:default decode:true">$ java -Djava.library.path="." HelloJNI</pre>


		<div style='height: 20px'>
    
    	<div style='float:left'>
        <a class="equalize" href="/jni-%ed%8a%9c%ed%86%a0%eb%a6%ac%ec%96%bc/" title="Previous Post: JNI 튜토리얼">
                <b> ← JNI 튜토리얼 </b>
        </a>
		</div>
    
    <div style='float:right'>
        <a class="equalize" href="/swift%ec%97%90-go%ec%96%b8%ec%96%b4%ec%9d%98-%ec%9e%a5%ec%a0%90%ec%9d%84-%eb%8d%94%ed%95%b4%eb%b3%b4%ec%9e%90/" title="next Post: Swift에 Go언어의 장점을 더해보자">
                <b> Swift에 Go언어의 장점을 더해보자 → </b>
        </a>
    </div>
</div>    
		
      </section>
    </div>
    <footer>
     <p></a></p>
     <p>Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    
  </body>
</html>
