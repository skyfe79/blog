<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Swift로 즐기는 이미지프로세싱 : Burt.K</title>

    <link href='https://fonts.googleapis.com/css?family=Lato:300italic,700italic,300,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header >
        <h1><a href="/">Burt.K</a></h1>
        
          <p>코코아를 좋아하는 프로그래머입니다 ;)</p>
        

        <ul>
          <li><a href="/about"><strong>소개</strong></a></li>
          <li><a href="/archive"><strong>아카이브</strong></a></li>
        </ul>        

      </header>
      <section>


		<h1 class="entry-title">
		
		    <a href="/swift%eb%a1%9c-%ec%a6%90%ea%b8%b0%eb%8a%94-%ec%9d%b4%eb%af%b8%ec%a7%80%ed%94%84%eb%a1%9c%ec%84%b8%ec%8b%b1/">Swift로 즐기는 이미지프로세싱</a>
		
		
		</h1>
		
      <p>Swift와 Playground를 즐길만한 놀이를 찾다가 간략하게 픽셀을 가지고 노는 걸 해보면 어떨까해서 만들어 보았습니다. 거창하게 이미지프로세싱이라 제목을 붙였지만 아주 간단한 것들만 해 보았습니다. 🙂 우연히 발견한 RGBAImage가 많은 도움이 되었습니다. 아래의 Playground는 <a href="https://github.com/skyfe79/SwiftImageProcessing">https://github.com/skyfe79/SwiftImageProcessing</a> 에서 받을 수 있습니다.</p>

<h3 id="swift-image-processing">Swift Image Processing</h3>

<p>This project contains swift playgrounds that demonstrate how to do pixel operations in swift.</p>

<h3 id="thanks-to-rgbaimage">Thanks to RGBAImage</h3>

<ul>
  <li><a href="http://mhorga.org/2015/10/19/image-processing-in-ios-part-3.html">http://mhorga.org/2015/10/19/image-processing-in-ios-part-3.html</a></li>
  <li>This articles help me a lot!</li>
</ul>

<h3 id="convert-uiimage-to-rgba-image">Convert UIImage to RGBA Image</h3>

<p>RGBAImage has pixels flat memory. You can access pixels with index directly.</p>

<p><img src="http://i2.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/01_rgba_image.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<h3 id="contrast">Contrast</h3>

<p>This is example for pixel operation</p>

<p><img src="http://i0.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/02_contrast.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<div class="highlight highlight-source-swift">
  <pre class="lang:default decode:true ">let rgba = RGBAImage(image: UIImage(named: "monet")!)!

var totalR = 0
var totalG = 0
var totalB = 0

rgba.process { (pixel) -&gt; Pixel in
    totalR += Int(pixel.R)
    totalG += Int(pixel.G)
    totalB += Int(pixel.B)
    return pixel
}

let pixelCount = rgba.width * rgba.height
let avgR = totalR / pixelCount
let avgG = totalG / pixelCount
let avgB = totalB / pixelCount

func contrast(image: RGBAImage) -&gt; RGBAImage {
    image.process { (var pixel) -&gt; Pixel in
        let deltaR = Int(pixel.R) - avgR
        let deltaG = Int(pixel.G) - avgG
        let deltaB = Int(pixel.B) - avgB
        pixel.R = UInt8(max(min(255, avgR + 3 * deltaR), 0)) //clamp
        pixel.G = UInt8(max(min(255, avgG + 3 * deltaG), 0))
        pixel.B = UInt8(max(min(255, avgB + 3 * deltaB), 0))

        return pixel
    }
    return image
}
let newImage = contrast(rgba).toUIImage()</pre>
  
  <p>
    &nbsp;
  </p>
</div>

<h3 id="grab-color-space">Grab color space</h3>

<h4 id="grab-red-component">Grab Red component</h4>

<p><img src="http://i0.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/03_grab_r.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<div class="highlight highlight-source-swift">
  <pre class="lang:default decode:true ">func grabR(image: RGBAImage) -&gt; RGBAImage {
    var outImage = image
    outImage.process { (var pixel) -&gt; Pixel in
        pixel.R = pixel.R
        pixel.G = 0
        pixel.B = 0
        return pixel
    }
    return outImage
}</pre>
  
  <p>
    &nbsp;
  </p>
</div>

<h4 id="grab-green-component">Grab Green component</h4>

<p><img src="http://i0.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/04_grab_g.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<div class="highlight highlight-source-swift">
  <pre class="lang:default decode:true">func grabG(image: RGBAImage) -&gt; RGBAImage {
    var outImage = image
    outImage.process { (var pixel) -&gt; Pixel in
        pixel.R = 0
        pixel.G = pixel.G
        pixel.B = 0
        return pixel
    }
    return outImage
}</pre>
  
  <p>
    &nbsp;
  </p>
</div>

<h4 id="grab-blue-component">Grab Blue component</h4>

<p><img src="http://i0.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/05_grab_b.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<div class="highlight highlight-source-swift">
  <pre class="lang:default decode:true">func grabB(image: RGBAImage) -&gt; RGBAImage {
    var outImage = image
    outImage.process { (var pixel) -&gt; Pixel in
        pixel.R = 0
        pixel.G = 0
        pixel.B = pixel.B
        return pixel
    }
    return outImage
}</pre>
</div>

<h4 id="compose-rgb-color-components">Compose RGB Color components</h4>

<p><img src="http://i1.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/06_composite.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<pre class="lang:default decode:true ">public static func composite(rgbaImageList: RGBAImage...) -&gt; RGBAImage {
    let result : RGBAImage = RGBAImage(width:rgbaImageList[0].width, height: rgbaImageList[0].height)
    for y in 0..&lt;result.height {
        for x in 0..&lt;result.width {

            let index = y * result.width + x
            var pixel = result.pixels[index]

            for rgba in rgbaImageList {
                let rgbaPixel = rgba.pixels[index]
                pixel.Rf = min(pixel.Rf + rgbaPixel.Rf, 1.0)
                pixel.Gf = min(pixel.Gf + rgbaPixel.Gf, 1.0)
                pixel.Bf = min(pixel.Bf + rgbaPixel.Bf, 1.0)
            }

            result.pixels[index] = pixel
        }
    }
    return result
}</pre>

<h3 id="rgb-to-gray">RGB to Gray</h3>

<p><img src="http://i2.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/07_rgb_to_gray.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<div class="highlight highlight-source-swift">
  <pre class="lang:default decode:true ">func gray5(image: RGBAImage) -&gt; RGBAImage {
    var outImage = image
    outImage.process { (var pixel) -&gt; Pixel in
        let result = sqrt(pow(pixel.Rf, 2) + pow(pixel.Rf, 2) + pow(pixel.Rf, 2))/sqrt(3.0)
        pixel.Rf = result
        pixel.Gf = result
        pixel.Bf = result
        return pixel
    }
    return outImage
}
let rgba5 = RGBAImage(image: UIImage(named: "monet")!)!
gray5(rgba5).toUIImage()</pre>
  
  <p>
    &nbsp;
  </p>
</div>

<h3 id="refactoring-split-color-space">Refactoring Split Color Space</h3>

<p><img src="http://i0.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/08_split.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<div class="highlight highlight-source-swift">
  <pre class="lang:default decode:true ">public static func splitRGB(rgba: RGBAImage) -&gt; (ByteImage, ByteImage, ByteImage) {
    let R = ByteImage(width: rgba.width, height: rgba.height)
    let G = ByteImage(width: rgba.width, height: rgba.height)
    let B = ByteImage(width: rgba.width, height: rgba.height)

    rgba.enumerate { (index, pixel) -&gt; Void in

        R.pixels[index] = pixel.R.toBytePixel()
        G.pixels[index] = pixel.G.toBytePixel()
        B.pixels[index] = pixel.B.toBytePixel()
    }

    return (R, G, B)
}</pre>
  
</div>

<p><code class="highlighter-rouge">ByteImage</code> has only one color component.</p>

<h3 id="images-add-sub-mul-div">Images ADD, SUB, MUL, DIV</h3>

<p><img src="http://i1.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/09_add_sub_mul_div.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<div class="highlight highlight-source-swift">
  <pre class="lang:default decode:true ">public static func op(functor : (Double, Double) -&gt; Double, rgbaImage1: RGBAImage, rgbaImage2: RGBAImage) -&gt; RGBAImage {
    let result : RGBAImage = RGBAImage(width:rgbaImage1.width, height: rgbaImage1.height)
    for y in 0..&lt;result.height {
        for x in 0..&lt;result.width {

            let index = y * result.width + x
            var pixel = result.pixels[index]

            let rgba1Pixel = rgbaImage1.pixels[index]
            let rgba2Pixel = rgbaImage2.pixels[index]


            pixel.Rf = min(functor(rgba1Pixel.Rf, rgba2Pixel.Rf), 1.0)
            pixel.Gf = min(functor(rgba1Pixel.Gf, rgba2Pixel.Gf), 1.0)
            pixel.Bf = min(functor(rgba1Pixel.Bf, rgba2Pixel.Bf), 1.0)

            result.pixels[index] = pixel
        }
    }
    return result

}
public static func add(rgba1: RGBAImage, _ rgba2: RGBAImage) -&gt; RGBAImage {
    return op((+), rgbaImage1: rgba1, rgbaImage2: rgba2)
}</pre>
  
  <p>
    &nbsp;
  </p>
</div>

<p><img src="http://i0.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/10_add_sub_mul_div.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<h3 id="blending">Blending</h3>

<p><img src="http://i1.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/11_blending.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<div class="highlight highlight-source-swift">
  <pre class="lang:default decode:true ">public static func blending(img1: RGBAImage, _ img2: RGBAImage, alpha: Double) -&gt; RGBAImage {
    let result : RGBAImage = RGBAImage(width:img1.width, height: img1.height)
    for y in 0..&lt;result.height {
        for x in 0..&lt;result.width {

            let index = y * result.width + x
            var pixel = result.pixels[index]

            let pixel1 = img1.pixels[index]
            let pixel2 = img2.pixels[index]


            pixel.Rf = min( alpha * pixel1.Rf + (1.0 - alpha) * pixel2.Rf, 1.0)
            pixel.Gf = min( alpha * pixel1.Gf + (1.0 - alpha) * pixel2.Gf, 1.0)
            pixel.Bf = min( alpha * pixel1.Bf + (1.0 - alpha) * pixel2.Bf, 1.0)

            result.pixels[index] = pixel
        }
    }
    return result
}</pre>
  
  <p>
    &nbsp;
  </p>
</div>

<h3 id="brightness">Brightness</h3>

<p><img src="http://i2.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/12_brightness.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<div class="highlight highlight-source-swift">
  <pre class="lang:default decode:true ">public static func brightness(img1: RGBAImage, contrast: Double, brightness: Double) -&gt; RGBAImage {
    let result : RGBAImage = RGBAImage(width:img1.width, height: img1.height)
    for y in 0..&lt;result.height {
        for x in 0..&lt;result.width {

            let index = y * result.width + x
            var pixel = result.pixels[index]

            let pixel1 = img1.pixels[index]

            pixel.Rf = min( pixel1.Rf * contrast + brightness, 1.0)
            pixel.Gf = min( pixel1.Gf * contrast + brightness, 1.0)
            pixel.Bf = min( pixel1.Bf * contrast + brightness, 1.0)

            result.pixels[index] = pixel
        }
    }
    return result
}</pre>
  
  <p>
    &nbsp;
  </p>
</div>

<h3 id="convolution">Convolution</h3>

<div class="highlight highlight-source-swift">
  <pre class="lang:default decode:true ">public static func convolution(var image: ByteImage, mask: Array2D&lt;Double&gt;) -&gt; ByteImage {

    let height = image.height
    let width  = image.width

    let maskHeight = mask.rowCount()
    let maskWidth  = mask.colCount()

    for y in 0..&lt;height - maskHeight + (maskHeight-1)/2 {
        for x in 0..&lt;width - maskWidth + (maskWidth-1)/2 {
            var v = 0.0
            if (y+maskHeight &gt; height) || (x+maskWidth) &gt; width {
                continue
            }

            for my in 0..&lt;maskHeight {
                for mx in 0..&lt;maskWidth {
                    let tmp = mask[my, mx]
                    v = v + (image.pixel(x+mx, y+my)!.Cf * tmp)
                }
            }

            v = clamp(v, lower: 0.0, upper: 1.0)
            print(v)
            let pixel = BytePixel(value: v)
            let xx = x+(maskWidth-1)/2
            let yy = y+(maskHeight-1)/2
            image.setPixel(xx, yy, pixel)
        }
    }
    return image
}</pre>
  
  <p>
    &nbsp;
  </p>
</div>

<h4 id="sharpening">Sharpening</h4>

<p><img src="http://i1.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/13_sharpening.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<div class="highlight highlight-source-swift">
  <pre class="lang:default decode:true ">let m1 = Array2D(cols:3, rows:3,
    [ 0.0/5.0, -1.0/5.0, 0.0/5.0,
     -1.0/5.0,  9.0/5.0,-1.0/5.0,
      0.0/5.0, -1.0/5.0, 0.0/5.0])
ImageProcess.convolution(R.clone(), mask: m1).toUIImage()</pre>
  
  <p>
    &nbsp;
  </p>
</div>

<h4 id="bluring">Bluring</h4>

<p><img src="http://i2.wp.com/github.com/skyfe79/SwiftImageProcessing/raw/master/art/14_blur.png?w=665&#038;ssl=1" alt="" class="fit-width" /></p>

<div class="highlight highlight-source-swift">
  <pre class="lang:default decode:true ">let m2 = Array2D(cols: 3, rows: 3,
    [
         1.0/9.0, 1.0/9.0, 1.0/9.0,
         1.0/9.0, 1.0/9.0, 1.0/9.0,
         1.0/9.0, 1.0/9.0, 1.0/9.0,
    ]
)
ImageProcess.convolution(R.clone(), mask: m2).toUIImage()</pre>
  
  <p>
    &nbsp;
  </p>
</div>


		<div style='height: 20px'>
    
    	<div style='float:left'>
        <a class="equalize" href="/%ec%8b%9c%ea%b7%b8%eb%a7%88%ec%99%80-fold/" title="Previous Post: 시그마와 Fold">
                <b> ← 시그마와 Fold </b>
        </a>
		</div>
    
    <div style='float:right'>
        <a class="equalize" href="/%ed%8e%98%ec%9d%b4%ec%8a%a4%eb%b6%81-ar-studio/" title="next Post: 페이스북, AR Studio!">
                <b> 페이스북, AR Studio! → </b>
        </a>
    </div>
</div>    
		
      </section>
    </div>
    <footer>
     <p></a></p>
     <p>Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    
  </body>
</html>
